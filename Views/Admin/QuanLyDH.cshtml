@using X.PagedList
@using System.Text.Json
@using ShopBanDoGiaDung.authorize
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    ViewBag.Title = "QuanLyDonHang";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    var dstatca = ViewBag.pagedList as PagedList<MyOrder>;
    var dschuathanhtoan = ViewBag.pagedList0 as PagedList<MyOrder>;
    var dschoxacnhan = ViewBag.pagedList1 as PagedList<MyOrder>;
    var dsdangvanchuyen = ViewBag.pagedList2 as PagedList<MyOrder>;
    var dsdahoanthanh = ViewBag.pagedList3 as PagedList<MyOrder>;
    var dsdahuy = ViewBag.pagedList4 as PagedList<MyOrder>;
    var chucvu = (List<ShopBanDoGiaDung.Models.ChucVu>)ViewBag.chucvu;
    List<AccountRole> data = HttpContextAccessor.HttpContext.Session.GetJson<List<AccountRole>>("QuyenTK") ?? new List<AccountRole>();
    var qh = data.FirstOrDefault(c => c.ActionName == "QuanLyDH");
    var max_price = ViewBag.MaxPrice;
    var min_price = ViewBag.MinPrice;
    var madh= ViewBag.madh;
    var tennn= ViewBag.tennn;
    var dc = ViewBag.dc;
    var ngaymua = ViewBag.ngaymua;
}

@if (qh == null || qh.MaA == 1)
{
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Full Screen Alert</title>
        <style>
            body {
                margin: 0;
                font-family: Arial, sans-serif;
            }

            .fullscreen-alert {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                align-items: center;
                justify-content: center;
                color: #fff;
                text-align: center;
                z-index: 1000;
            }

            .alert-content {
                background-color: #343a40;
                padding: 20px;
                border-radius: 8px;
            }

            .close-btn {
                cursor: pointer;
                color: #fff;
                font-size: 20px;
                position: absolute;
                top: 10px;
                right: 10px;
            }
        </style>
    </head>
    <body>

        <div class="fullscreen-alert" id="fullscreenAlert">
            <div class="alert-content">
                <span class="close-btn" onclick="closeFullscreenAlert()">&times;</span>
                <h1>Truy cập thất bại</h1>
                <p>Bạn không có quyền truy cập trang này. Vui lòng liên hệ với chúng tôi để nhận hỗ trợ </p>
            </div>
        </div>

        <script>
            function showFullscreenAlert() {
                document.getElementById('fullscreenAlert').style.display = 'flex';
            }

            function closeFullscreenAlert() {
                document.getElementById('fullscreenAlert').style.display = 'none';
            }

            // Gọi hàm này khi trang web được tải
            document.addEventListener('DOMContentLoaded', function () {
                showFullscreenAlert();
            });
        </script>

    </body>
    </html>


}
else
{
    
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <label class="card-title">Quản lý đơn hàng</label>
                            </div>                           
                            <ul class="nav nav-tabs" role="tablist">
                                <li class=" nav-item active"><a class="nav-link active" data-toggle="tab" href="#Admin"><label>Tất cả đơn hàng (@ViewBag.TotalOrdersCount)</label></a></li>
                                @* <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#menu0">Chưa thanh toán (@ViewBag.UnpaidOrdersCount)</a></li> *@
                                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#menu1"><label>Chờ xác nhận (@ViewBag.PendingOrdersCount)</label></a></li>
                                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#menu2"><label>Đang vận chuyển (@ViewBag.ShippingOrdersCount)</label></a></li>
                                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#menu3"><label>Đã hoàn thành (@ViewBag.CompletedOrdersCount)</label></a></li>
                                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#menu4"><label>Đã hủy (@ViewBag.CanceledOrdersCount)</label></a></li>
                            </ul>
                            <script>
                                $(document).ready(function () {
                                    // Hàm khởi tạo DataTable cho tất cả các bảng
                                    function initializeAllTables() {
                                        // Khởi tạo cho bảng Chờ xác nhận
                                        $('#showtable1').DataTable({
                                            "responsive": true,
                                            "lengthChange": false,
                                            "autoWidth": false,
                                            "paging": false,
                                            "info": false,
                                            "searching": true,
                                            "ordering": true,
                                        });
                                        // Khởi tạo cho bảng Tất cả đơn hàng
                                        $('#showtable').DataTable({
                                            "responsive": true,
                                            "lengthChange": false,
                                            "autoWidth": false,
                                            "paging": false,
                                            "info": false,
                                            "searching": true,
                                            "ordering": true,
                                        });

                                        

                                        // Khởi tạo cho bảng Đang vận chuyển
                                        $('#showtable2').DataTable({
                                            "responsive": true,
                                            "lengthChange": false,
                                            "autoWidth": false,
                                            "paging": false,
                                            "info": false,
                                            "searching": true,
                                            "ordering": true,
                                        });

                                        // Khởi tạo cho bảng Đã hoàn thành
                                        $('#showtable3').DataTable({
                                            "responsive": true,
                                            "lengthChange": false,
                                            "autoWidth": false,
                                            "paging": false,
                                            "info": false,
                                            "searching": true,
                                            "ordering": true,
                                        });

                                        // Khởi tạo cho bảng Đã hủy
                                        $('#showtable4').DataTable({
                                            "responsive": true,
                                            "lengthChange": false,
                                            "autoWidth": false,
                                            "paging": false,
                                            "info": false,
                                            "searching": true,
                                            "ordering": true,
                                        });
                                    }

                                    // Khởi tạo tất cả DataTable khi trang được tải
                                    initializeAllTables();

                                    // Tìm kiếm toàn cục cho bảng trong tab hiện tại
                                    $('#globalSearch').on('keyup', function () {
                                        var activeTable = $('div.tab-pane.active').find('table').DataTable(); // Tìm DataTable trong tab đang hiển thị
                                        activeTable.search(this.value).draw(); // Thực hiện tìm kiếm
                                    });
                                });
                            </script>
                            <!-- /.card-header -->
                            <div class="card-body">
                                <div class="tab-content">
                                    <div id="Admin" class="tab-pane active">
                                        <table id="showtable" class="table table-bordered table-striped">
                                            <thead>
                                                
                                                <tr>
                                                    <td>Mã đơn hàng</td>
                                                    <td>Người nhận</td>
                                                    <td>Địa chỉ giao hàng</td>
                                                    <td>Ngày mua</td>
                                                    <td>Tổng tiền</td>
                                                    <td>Tình trạng</td>
                                                    <td>Chi tiết</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in dstatca)
                                                {
                                                    <tr>
                                                        <td>@item.MaDonHang</td>
                                                        <td>@item.NguoiNhan</td>
                                                        <td>@item.DiaChi</td>
                                                        <td>@item.NgayMua.Value.ToShortDateString()</td>
                                                        <td>@item.TongTien.Value.ToString("N0") VND</td>
                                                        @if (item.TinhTrang == 0)
                                                        {
                                                            <td>Chưa thanh toán</td>
                                                        }
                                                        @if (item.TinhTrang == 1)
                                                        {
                                                            <td>Chờ xác nhận</td>
                                                        }
                                                        @if (item.TinhTrang == 2)
                                                        {
                                                            <td>Đang giao hàng</td>
                                                        }
                                                        @if (item.TinhTrang == 3)
                                                        {
                                                            <td>Đã hoàn thành</td>
                                                        }
                                                        @if (item.TinhTrang == 4)
                                                        {
                                                            <td>Đã hủy</td>
                                                        }
                                                        <td><a class="btn btn-success" data-toggle="modal" id="viewbtn" data-target="#showmodal">Chi tiết</a></td>

                                                    </tr>
                                                }
                                            </tbody>                                           
                                        </table>
                                       
                                        <div class="row">
                                            <div class="col-sm-12 col-md-5">
                                                <div class="dataTables_info" id="example1_info" role="status" aria-live="polite">
                                                    Danh sách từ @dstatca.FirstItemOnPage đến @dstatca.LastItemOnPage  trên tổng số @dstatca.TotalItemCount đơn hàng
                                                </div>
                                            </div>
                                            <ul class="pagination">

                                                @if (dstatca.HasPreviousPage)
                                                {
                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dstatca.PageNumber - 1 })">Previous</a>
                                                    </li>

                                                }
                                                <li class="page-item @(1 == dstatca.PageNumber ? "active" : "")">
                                                    <a class="page-link" href="@Url.Action("QuanLyDH", new { page = 1 })">1</a>
                                                </li>
                                                @if (dstatca.PageNumber > 3)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @for (int i = dstatca.PageNumber - 1; i <= dstatca.PageNumber + 1; i++)
                                                {
                                                    if (i > 1 && i < dstatca.PageCount)
                                                    {
                                                        <li class="page-item @(i == dstatca.PageNumber ? "active" : "")">
                                                            <a class="page-link" href="@Url.Action("QuanLyDH", new { page = i })">@i</a>
                                                        </li>
                                                    }
                                                }
                                                @if (dstatca.PageNumber < dstatca.PageCount - 1)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @if (dstatca.PageCount > 1)
                                                {
                                                    <li class="page-item @(dstatca.PageCount == dstatca.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dstatca.PageCount })">@dstatca.PageCount</a>
                                                    </li>
                                                }
                                                @if (dstatca.HasNextPage)
                                                {

                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dstatca.PageNumber + 1 })">Next</a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                        <div id="showmodal" class="modal fade" role="dialog">
                                            <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="display: flex; align-items: center; height: 100%; margin-bottom: 0; margin-top: 0">
                                            </div>
                                        </div>
                                        <script>
                                            $("#showtable").on("click", "#viewbtn", function () {
                                                var id = $(this).closest("tr").find("td").eq(0).html();
                                                $.ajax({
                                                    url: "@Url.Action("MyOrderDetail", "Admin")",
                                                    data: { id: id },
                                                    success: function (data) {
                                                        $("#showmodal .modal-dialog").html(data);

                                                    }
                                                });
                                            });
                                        </script>

                                    </div>
                                  
                                    <div id="menu1" class="tab-pane fade">
                                        <table id="showtable1" class="table table-bordered table-hover">
                                            <thead>                                             
                                                <tr>
                                                    <td>Mã đơn hàng</td>
                                                    <td>Người nhận</td>
                                                    <td>Địa chỉ giao hàng</td>
                                                    <td>Ngày mua</td>
                                                    <td>Tổng tiền</td>
                                                    <td>Tình trạng</td>
                                                    <td>Chi tiết</td>
                                                    <td>Xác nhận</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in dschoxacnhan)
                                                {
                                                    <tr>
                                                        <td>@item.MaDonHang</td>
                                                        <td>@item.NguoiNhan</td>
                                                        <td>@item.DiaChi</td>
                                                        <td>@item.NgayMua.Value.ToShortDateString()</td>
                                                        <td>@item.TongTien.Value.ToString("N0") VND</td>
                                                        @if (item.TinhTrang == 0)
                                                        {
                                                            <td>Chưa thanh toán</td>
                                                        }
                                                        @if (item.TinhTrang == 1)
                                                        {
                                                            <td>Chờ xác nhận</td>
                                                        }
                                                        @if (item.TinhTrang == 2)
                                                        {
                                                            <td>Đang giao hàng</td>
                                                        }
                                                        @if (item.TinhTrang == 3)
                                                        {
                                                            <td>Đã hoàn thành</td>
                                                        }
                                                        @if (item.TinhTrang == 4)
                                                        {
                                                            <td>Đã hủy</td>
                                                        }
                                                        <td><a class="btn btn-success" data-toggle="modal" id="viewbtn1" data-target="#showmodal1">Chi tiết</a></td>
                                                        @if (qh.MaA != 2)
                                                        {
                                                            <td><a class="btn btn-danger" id="btnXacNhan">Xác nhận</a></td>
                                                        }                                                        
                                                    </tr>
                                                }
                                            </tbody>                                           
                                        </table>
                                      
                                        <div class="row">
                                            <div class="col-sm-12 col-md-5">
                                                <div class="dataTables_info" id="example1_info" role="status" aria-live="polite">
                                                    Danh sách từ @dschoxacnhan.FirstItemOnPage đến @dschoxacnhan.LastItemOnPage  trên tổng số @dschoxacnhan.TotalItemCount đơn hàng
                                                </div>
                                            </div>
                                            <ul class="pagination">

                                                @if (dschoxacnhan.HasPreviousPage)
                                                {
                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dschoxacnhan.PageNumber - 1 })">Previous</a>
                                                    </li>

                                                }
                                                <li class="page-item @(1 == dschoxacnhan.PageNumber ? "active" : "")">
                                                    <a class="page-link" href="@Url.Action("QuanLyDH", new { page = 1 })">1</a>
                                                </li>
                                                @if (dschoxacnhan.PageNumber > 3)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @for (int i = dschoxacnhan.PageNumber - 1; i <= dschoxacnhan.PageNumber + 1; i++)
                                                {
                                                    if (i > 1 && i < dschoxacnhan.PageCount)
                                                    {
                                                        <li class="page-item @(i == dschoxacnhan.PageNumber ? "active" : "")">
                                                            <a class="page-link" href="@Url.Action("QuanLyDH", new { page = i })">@i</a>
                                                        </li>
                                                    }
                                                }
                                                @if (dschoxacnhan.PageNumber < dschoxacnhan.PageCount - 1)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @if (dschoxacnhan.PageCount > 1)
                                                {
                                                    <li class="page-item @(dschoxacnhan.PageCount == dschoxacnhan.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dschoxacnhan.PageCount })">@dschoxacnhan.PageCount</a>
                                                    </li>
                                                }
                                                @if (dschoxacnhan.HasNextPage)
                                                {

                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dschoxacnhan.PageNumber + 1 })">Next</a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                        <div id="showmodal1" class="modal fade" role="dialog">
                                            <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="display: flex; align-items: center; height: 100%; margin-bottom: 0; margin-top: 0">
                                            </div>
                                            <script>
                                                $("#showtable1").on("click", "#viewbtn1", function () {
                                                    var id = $(this).closest("tr").find("td").eq(0).html();
                                                    $.ajax({
                                                        url: "@Url.Action("MyOrderDetail", "Admin")",
                                                        data: { id: id },
                                                        success: function (data) {
                                                            $("#showmodal1 .modal-dialog").html(data);
                                                            /* $("#showmodal").modal('show')*/
                                                        }
                                                    });
                                                });
                                                $("#showtable1").on("click", "#btnXacNhan", function () {
                                                    var id = $(this).closest("tr").find("td").eq(0).html();
                                                    $.ajax({
                                                        url: "@Url.Action("XacNhanDH", "Admin")",
                                                        data: { madh: id },
                                                        success: function (res) {
                                                            if (res.status == true) {
                                                                window.location.href = "/Admin/QuanLyDH";
                                                            }
                                                            /*$("#showmodal1 .modal-dialog").html(data);*/
                                                            /* $("#showmodal").modal('show')*/
                                                        }
                                                    });
                                                });
                                            </script>

                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <div id="menu2" class="tab-pane fade">
                                        <table id="showtable2" class="table table-bordered table-hover">
                                            <thead>
                                                
                                                <tr>
                                                    <td>Mã đơn hàng</td>
                                                    <td>Người nhận</td>
                                                    <td>Địa chỉ giao hàng</td>
                                                    <td>Ngày mua</td>
                                                    <td>Tổng tiền</td>
                                                    <td>Tình trạng</td>
                                                    <td>Chi tiết</td>
                                                    <td>Giao hàng</td>
                                                    <td>Hủy đơn</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in dsdangvanchuyen)
                                                {
                                                    <tr>
                                                        <td>@item.MaDonHang</td>
                                                        <td>@item.NguoiNhan</td>
                                                        <td>@item.DiaChi</td>
                                                        <td>@item.NgayMua.Value.ToShortDateString()</td>
                                                        <td>@item.TongTien.Value.ToString("N0") VND</td>
                                                        @if (item.TinhTrang == 0)
                                                        {
                                                            <td>Chưa thanh toán</td>
                                                        }
                                                        @if (item.TinhTrang == 1)
                                                        {
                                                            <td>Chờ xác nhận</td>
                                                        }
                                                        @if (item.TinhTrang == 2)
                                                        {
                                                            <td>Đang giao hàng</td>
                                                        }
                                                        @if (item.TinhTrang == 3)
                                                        {
                                                            <td>Đã hoàn thành</td>
                                                        }
                                                        @if (item.TinhTrang == 4)
                                                        {
                                                            <td>Đã hủy</td>
                                                        }
                                                        <td><a class="btn btn-success" data-toggle="modal" id="viewbtn2" data-target="#showmodal2">Chi tiết</a></td>
                                                        @if (qh.MaA != 2)
                                                        {
                                                        <td><a class="btn btn-success" id="btnDaGiao" >Đã giao</a></td>
                                                        <td><a class="btn btn-danger" id="btnDaHuy" >Đã hủy</a></td>
                                                        }
                                                        



                                                    </tr>
                                                }
                                            </tbody>                                          
                                        </table>
                                       
                                        <div class="row">
                                            <div class="col-sm-12 col-md-5">
                                                <div class="dataTables_info" id="example1_info" role="status" aria-live="polite">
                                                    Danh sách từ @dsdangvanchuyen.FirstItemOnPage đến @dsdangvanchuyen.LastItemOnPage  trên tổng số @dsdangvanchuyen.TotalItemCount đơn hàng
                                                </div>
                                            </div>
                                            <ul class="pagination">

                                                @if (dsdangvanchuyen.HasPreviousPage)
                                                {
                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdangvanchuyen.PageNumber - 1 })">Previous</a>
                                                    </li>

                                                }
                                                <li class="page-item @(1 == dsdangvanchuyen.PageNumber ? "active" : "")">
                                                    <a class="page-link" href="@Url.Action("QuanLyDH", new { page = 1 })">1</a>
                                                </li>
                                                @if (dsdangvanchuyen.PageNumber > 3)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @for (int i = dsdangvanchuyen.PageNumber - 1; i <= dsdangvanchuyen.PageNumber + 1; i++)
                                                {
                                                    if (i > 1 && i < dsdangvanchuyen.PageCount)
                                                    {
                                                        <li class="page-item @(i == dsdangvanchuyen.PageNumber ? "active" : "")">
                                                            <a class="page-link" href="@Url.Action("QuanLyDH", new { page = i })">@i</a>
                                                        </li>
                                                    }
                                                }
                                                @if (dsdangvanchuyen.PageNumber < dsdangvanchuyen.PageCount - 1)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @if (dsdangvanchuyen.PageCount > 1)
                                                {
                                                    <li class="page-item @(dsdangvanchuyen.PageCount == dsdangvanchuyen.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdangvanchuyen.PageCount })">@dsdangvanchuyen.PageCount</a>
                                                    </li>
                                                }
                                                @if (dsdangvanchuyen.HasNextPage)
                                                {

                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdangvanchuyen.PageNumber + 1 })">Next</a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                        <div id="showmodal2" class="modal fade" role="dialog">
                                            <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="display: flex; align-items: center; height: 100%; margin-bottom: 0; margin-top: 0">
                                            </div>
                                            <script>
                                                $("#showtable2").on("click", "#viewbtn2", function () {
                                                    var id = $(this).closest("tr").find("td").eq(0).html();
                                                    $.ajax({
                                                        url: "@Url.Action("MyOrderDetail", "Admin")",
                                                        data: { id: id },
                                                        success: function (data) {
                                                            $("#showmodal2 .modal-dialog").html(data);
                                                            /* $("#showmodal").modal('show')*/
                                                        }
                                                    });
                                                });
                                                $("#showtable2").on("click", "#btnDaGiao", function () {
                                                    var id = $(this).closest("tr").find("td").eq(0).html();
                                                    $.ajax({
                                                        url: "@Url.Action("VanChuyenDH", "Admin")",
                                                        data: { madh: id },
                                                        success: function (res) {
                                                            if (res.status == true) {
                                                                window.location.href = "/Admin/QuanLyDH";
                                                            }
                                                            /*$("#showmodal1 .modal-dialog").html(data);*/
                                                            /* $("#showmodal").modal('show')*/
                                                        }
                                                    });
                                                });
                                                $("#showtable2").on("click", "#btnDaHuy", function () {
                                                    var id = $(this).closest("tr").find("td").eq(0).html();
                                                    $.ajax({
                                                        url: "@Url.Action("HuyDH", "Admin")",
                                                        data: { madh: id },
                                                        success: function (res) {
                                                            if (res.status == true) {
                                                                window.location.href = "/Admin/QuanLyDH";
                                                            }
                                                            /*$("#showmodal1 .modal-dialog").html(data);*/
                                                            /* $("#showmodal").modal('show')*/
                                                        }
                                                    });
                                                });
                                            </script>

                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <div id="menu3" class="tab-pane fade">
                                        <table id="showtable3" class="table table-bordered table-hover">
                                            <thead>
                                               
                                                <tr>
                                                    <td>Mã đơn hàng</td>
                                                    <td>Người nhận</td>
                                                    <td>Địa chỉ giao hàng</td>
                                                    <td>Ngày mua</td>
                                                    <td>Tổng tiền</td>
                                                    <td>Tình trạng</td>
                                                    <td>Chi tiết</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in dsdahoanthanh)
                                                {
                                                    <tr>
                                                        <td>@item.MaDonHang</td>
                                                        <td>@item.NguoiNhan</td>
                                                        <td>@item.DiaChi</td>
                                                        <td>@item.NgayMua.Value.ToShortDateString()</td>
                                                        <td>@item.TongTien.Value.ToString("N0") VND</td>
                                                        @if (item.TinhTrang == 0)
                                                        {
                                                            <td>Chưa thanh toán</td>
                                                        }
                                                        @if (item.TinhTrang == 1)
                                                        {
                                                            <td>Chờ xác nhận</td>
                                                        }
                                                        @if (item.TinhTrang == 2)
                                                        {
                                                            <td>Đang giao hàng</td>
                                                        }
                                                        @if (item.TinhTrang == 3)
                                                        {
                                                            <td>Đã hoàn thành</td>
                                                        }
                                                        @if (item.TinhTrang == 4)
                                                        {
                                                            <td>Đã hủy</td>
                                                        }
                                                        <td><a class="btn btn-success" data-toggle="modal" id="viewbtn3" data-target="#showmodal3">Chi tiết</a></td>
                                                        @*<td><a class="btn btn-danger" data-target="#showmodal2">Đã nhận được hàng</a></td>*@


                                                    </tr>
                                                }
                                            </tbody>                                           
                                        </table>
                                       
                                        <div class="row">
                                            <div class="col-sm-12 col-md-5">
                                                <div class="dataTables_info" id="example1_info" role="status" aria-live="polite">
                                                    Danh sách từ @dsdahoanthanh.FirstItemOnPage đến @dsdahoanthanh.LastItemOnPage  trên tổng số @dsdahoanthanh.TotalItemCount đơn hàng
                                                </div>
                                            </div>
                                            <ul class="pagination">

                                                @if (dsdahoanthanh.HasPreviousPage)
                                                {
                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdahoanthanh.PageNumber - 1 })">Previous</a>
                                                    </li>

                                                }
                                                <li class="page-item @(1 == dsdahoanthanh.PageNumber ? "active" : "")">
                                                    <a class="page-link" href="@Url.Action("QuanLyDH", new { page = 1 })">1</a>
                                                </li>
                                                @if (dsdahoanthanh.PageNumber > 3)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @for (int i = dsdahoanthanh.PageNumber - 1; i <= dsdahoanthanh.PageNumber + 1; i++)
                                                {
                                                    if (i > 1 && i < dsdahoanthanh.PageCount)
                                                    {
                                                        <li class="page-item @(i == dsdahoanthanh.PageNumber ? "active" : "")">
                                                            <a class="page-link" href="@Url.Action("QuanLyDH", new { page = i })">@i</a>
                                                        </li>
                                                    }
                                                }
                                                @if (dsdahoanthanh.PageNumber < dsdahoanthanh.PageCount - 1)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @if (dsdahoanthanh.PageCount > 1)
                                                {
                                                    <li class="page-item @(dsdahoanthanh.PageCount == dsdahoanthanh.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdahoanthanh.PageCount })">@dsdahoanthanh.PageCount</a>
                                                    </li>
                                                }
                                                @if (dsdahoanthanh.HasNextPage)
                                                {

                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdahoanthanh.PageNumber + 1 })">Next</a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                        <div id="showmodal3" class="modal fade" role="dialog">
                                            <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="display: flex; align-items: center; height: 100%; margin-bottom: 0; margin-top: 0">
                                            </div>
                                            <script>
                                                $("#showtable3").on("click", "#viewbtn3", function () {
                                                    var id = $(this).closest("tr").find("td").eq(0).html();
                                                    $.ajax({
                                                        url: "@Url.Action("MyOrderDetail", "Admin")",
                                                        data: { id: id },
                                                        success: function (data) {
                                                            $("#showmodal3 .modal-dialog").html(data);
                                                            /* $("#showmodal").modal('show')*/
                                                        }
                                                    });
                                                });
                                            </script>

                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <div id="menu4" class="tab-pane fade">
                                        <table id="showtable4" class="table table-bordered table-hover">
                                            <thead>
                                               
                                                <tr>
                                                    <td>Mã đơn hàng</td>
                                                    <td>Người nhận</td>
                                                    <td>Địa chỉ giao hàng</td>
                                                    <td>Ngày mua</td>
                                                    <td>Tổng tiền</td>
                                                    <td>Tình trạng</td>
                                                    <td>Chi tiết</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in dsdahuy)
                                                {
                                                    <tr>
                                                        <td>@item.MaDonHang</td>
                                                        <td>@item.NguoiNhan</td>
                                                        <td>@item.DiaChi</td>
                                                        <td>@item.NgayMua.Value.ToShortDateString()</td>
                                                        <td>@item.TongTien.Value.ToString("N0") VND</td>
                                                        @if (item.TinhTrang == 0)
                                                        {
                                                            <td>Chưa thanh toán</td>
                                                        }
                                                        @if (item.TinhTrang == 1)
                                                        {
                                                            <td>Chờ xác nhận</td>
                                                        }
                                                        @if (item.TinhTrang == 2)
                                                        {
                                                            <td>Đang giao hàng</td>
                                                        }
                                                        @if (item.TinhTrang == 3)
                                                        {
                                                            <td>Đã hoàn thành</td>
                                                        }
                                                        @if (item.TinhTrang == 4)
                                                        {
                                                            <td>Đã hủy</td>
                                                        }
                                                        <td><a class="btn btn-success" data-toggle="modal" id="viewbtn4" data-target="#showmodal4">Chi tiết</a></td>
                                                        @*<td><a class="btn btn-danger" data-target="#showmodal2">Đã nhận được hàng</a></td>*@



                                                    </tr>
                                                }
                                            </tbody>                                           
                                        </table>
                                       
                                        <div class="row">
                                            <div class="col-sm-12 col-md-5">
                                                <div class="dataTables_info" id="example1_info" role="status" aria-live="polite">
                                                    Danh sách từ @dsdahuy.FirstItemOnPage đến @dsdahuy.LastItemOnPage  trên tổng số @dsdahuy.TotalItemCount đơn hàng
                                                </div>
                                            </div>
                                            <ul class="pagination">

                                                @if (dsdahuy.HasPreviousPage)
                                                {
                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdahuy.PageNumber - 1 })">Previous</a>
                                                    </li>

                                                }
                                                <li class="page-item @(1 == dsdahuy.PageNumber ? "active" : "")">
                                                    <a class="page-link" href="@Url.Action("QuanLyDH", new { page = 1 })">1</a>
                                                </li>
                                                @if (dsdahuy.PageNumber > 3)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @for (int i = dsdahuy.PageNumber - 1; i <= dsdahuy.PageNumber + 1; i++)
                                                {
                                                    if (i > 1 && i < dsdahuy.PageCount)
                                                    {
                                                        <li class="page-item @(i == dsdahuy.PageNumber ? "active" : "")">
                                                            <a class="page-link" href="@Url.Action("QuanLyDH", new { page = i })">@i</a>
                                                        </li>
                                                    }
                                                }
                                                @if (dsdahuy.PageNumber < dsdahuy.PageCount - 1)
                                                {
                                                    <li class="page-item">
                                                        <span class="page-link">...</span>
                                                    </li>
                                                }
                                                @if (dsdahuy.PageCount > 1)
                                                {
                                                    <li class="page-item @(dsdahuy.PageCount == dsdahuy.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdahuy.PageCount })">@dsdahuy.PageCount</a>
                                                    </li>
                                                }
                                                @if (dsdahuy.HasNextPage)
                                                {

                                                    <li class="page-item">
                                                        <a class="page-link" href="@Url.Action("QuanLyDH", new { page = dsdahuy.PageNumber + 1 })">Next</a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                        <div id="showmodal4" class="modal fade" role="dialog">
                                            <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="display: flex; align-items: center; height: 100%; margin-bottom: 0; margin-top: 0">
                                            </div>
                                            <script>
                                                $("#showtable4").on("click", "#viewbtn4", function () {
                                                    var id = $(this).closest("tr").find("td").eq(0).html();
                                                    $.ajax({
                                                        url: "@Url.Action("MyOrderDetail", "Admin")",
                                                        data: { id: id },
                                                        success: function (data) {
                                                            $("#showmodal4 .modal-dialog").html(data);
                                                            /* $("#showmodal").modal('show')*/
                                                        }
                                                    });
                                                });
                                            </script>

                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                </div>
                                <!-- /.card -->
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->
                    </div>
                </div>
            </div>


            <!-- /.container-fluid -->
        </section>
        <!-- /.content -->
    </div>
    <!-- Đoạn mã HTML cho modal xác nhận xóa -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">Bạn có chắc chắn muốn xóa tài khoản?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="confirmDeleteButton">Xóa</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                </div>
            </div>
        </div>
    </div>
  
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- Đoạn mã JavaScript để xử lý sự kiện xóa -->
    <script>
        function XoaTK(ma) {
            var matk = parseInt(ma);

            // Hiển thị modal xác nhận xóa
            $('#confirmDeleteModal').modal('show');

            // Xử lý sự kiện khi người dùng xác nhận xóa
            $('#confirmDeleteButton').on('click', function () {
                $.ajax({
                    url: '/Admin/XoaTK',
                    data: {
                        matk: matk
                    },
                    type: 'POST',
                    dataType: 'json',
                    success: function (res) {
                        if (res.status == true) {
                            // Đóng modal sau khi xóa thành công
                            $('#confirmDeleteModal').modal('hide');
                            window.location = '@Url.Action("QuanLyTK","Admin")';
                        }
                    }
                });
            });
        }
        $(document).ready(function () {
         
            $("#filterButton").click(function () {
                // Lấy giá trị từ các input
                var madh = $("thead tr:nth-child(1) th:nth-child(1) input").val();
                var tennn = $("thead tr:nth-child(1) th:nth-child(2) input").val();
                var dc = $("thead tr:nth-child(1) th:nth-child(3) input").val();
                var ngaymua = $("thead tr:nth-child(1) th:nth-child(4) input").val();
                var minPrice = $("thead tr:nth-child(1) th:nth-child(5) input:nth-child(1)").val();
                var maxPrice = $("thead tr:nth-child(1) th:nth-child(5) input:nth-child(2)").val();

                // Redirect đến URL với các tham số tìm kiếm
                var url = '@Url.Action("QuanLyDH", "Admin")?madh=' + madh + '&tennn=' + tennn + '&dc=' + dc + '&ngaymua=' + ngaymua + '&minPrice=' + minPrice + '&maxPrice=' + maxPrice;
                window.location.href = url;
            });


        });
      
    </script>
   

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>

    <script src="~/Admin/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="~/Admin/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables  & Plugins -->
    <link rel="stylesheet" href="~/Admin/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="~/Admin/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">

    <script src="~/Admin/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Admin/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/Admin/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/Admin/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/Admin/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Admin/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="~/Admin/plugins/jszip/jszip.min.js"></script>
    <script src="~/Admin/plugins/pdfmake/pdfmake.min.js"></script>
    <script src="~/Admin/plugins/pdfmake/vfs_fonts.js"></script>
    <script src="~/Admin/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Admin/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="~/Admin/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
    <!-- AdminLTE App -->
    <script src="~/Admin/dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="~/Admin/dist/js/demo.js"></script>
}
<!-- Content Wrapper. Contains page content -->
